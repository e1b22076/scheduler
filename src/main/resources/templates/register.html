<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <title>新規登録</title>
  <style>
    .center {
      width: fit-content;
      margin: auto;
    }

    .center th {
      text-align: left;
      vertical-align: top;
    }

    #gakuseki_chk,
    #mail_chk,
    #pass_chk {
      display: none;
      color: red;
    }
  </style>
</head>

<body>
  <form class="center" action="/register" method="post" th:action="@{/register}" novalidate>

    <table>
      <tr>
        <th><label for="gakuseki">学籍番号</label></th>
        <td>
          <input id="gakuseki" type="text" placeholder="A12345" name="gakuseki" />
        </td>
        <td id="gakuseki_chk">
          学籍番号の形式が違います
        </td>
      </tr>

      <tr>
        <th><label for="myname">ユーザーネーム</label></th>
        <td>
          <input id="myname" type="text" placeholder="任意入力" name="myname" />
        </td>
      </tr>

      <tr>
        <th><label for="mail">学校用メールアドレス</label></th>
        <td>
          <input id="mail" type="email" placeholder="e1a12345@oit.ac.jp" name="mail" />
        </td>
        <td id="mail_chk">
          メールアドレスの形式が違います
        </td>
      </tr>

      <tr>
        <th><label for="password">パスワード</label></th>
        <td>
          <input id="password" type="password" name="pass" />
        </td>
      </tr>

      <tr>
        <th><label for="repassword">パスワード再入力</label></th>
        <td>
          <input id="repassword" type="password" name="repass" />
        </td>
        <td id="pass_chk">
          パスワードが違います
        </td>
      </tr>
    </table>
    <input type="submit" value="登録" id="touroku">
    <input type="reset" value="リセット">
  </form>

  <script>
    // フォームのバリデーション
    window.onload = function () {
      document.getElementById("touroku").addEventListener("click", function (event) {
        const gakuseki = document.getElementById("gakuseki").value;
        const mail = document.getElementById("mail").value;
        const password = document.getElementById("password").value;
        const repassword = document.getElementById("repassword").value;

        let hasError = false;

        // 必須項目のチェック
        if (gakuseki.trim().length === 0) {
          alert('学籍番号を入力してください。');
          hasError = true;
        }

        if (mail.trim().length === 0) {
          alert('メールアドレスを入力してください。');
          hasError = true;
        }

        if (password.trim().length === 0) {
          alert('パスワードを入力してください。');
          hasError = true;
        }
        if (repassword.trim().length === 0) {
          alert('パスワードを再入力してください。');
          hasError = true;
        }

        // 入力形式のチェック
        let formatError = false;

        // 学籍番号の形式チェック
        const gakusekiRegex = /^[A-Z]\d{5}$/;
        if (!gakusekiRegex.test(gakuseki)) {
          document.getElementById('gakuseki_chk').style.display = "block";
          formatError = true;
        } else {
          document.getElementById('gakuseki_chk').style.display = "none";
        }

        // メールアドレスの形式チェック
        const mailRegex = /^e1[a-z]\d{5}@oit\.ac\.jp$/;
        if (!mailRegex.test(mail)) {
          document.getElementById('mail_chk').style.display = "block";
          formatError = true;
        } else {
          document.getElementById('mail_chk').style.display = "none";
        }

        //パスワードのチェック
        if (password != repassword) {
          document.getElementById('pass_chk').style.display = "block";
          formatError = true;
        } else {
          document.getElementById('pass_chk').style.display = "none";
        }

        // エラーがある場合はフォーム送信を停止
        if (hasError || formatError) {
          event.preventDefault();
          return false;
        }
      });
    };
  </script>
</body>

</html>
