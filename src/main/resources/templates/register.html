<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>新規登録</title>
  <link rel="stylesheet" href="css/common.css">
  <link rel="stylesheet" href="css/register.css">
</head>

<body>
  <!-- メニューバー -->
  <div class="navbar">
    <a href="/index.html" class="link">戻る</a>
  </div>

  <form action="/regfin" method="post" th:action="@{/regfin}" novalidate>
    <!-- CSRFトークンの追加 -->
    <input type="hidden" name="_csrf" th:value="${_csrf.token}" />

    <table>
      <tr>
        <th><label for="gakuseki">学籍番号</label></th>
        <td><input type="text" id="gakuseki" name="gakuseki" class="form-control" required></td>
        <span id="gakuseki_chk">学籍番号の形式が正しくありません。</span>
      </tr>
      <tr>
        <th><label for="password">パスワード</label></th>
        <td><input type="password" id="password" name="pass" class="form-control" required></td>
      </tr>
      <tr>
        <th><label for="confirmPassword">パスワード確認</label></th>
        <td><input type="password" id="confirmPassword" name="conPass" class="form-control" required></td>
      </tr>
      <tr>
        <th><label for="mail">メールアドレス</label></th>
        <td><input type="mail" id="mail" name="mail" class="form-control" required></td>
        <span id="mail_chk">メールアドレスの形式が正しくありません。</span>
      </tr>
    </table>

    <div class="form-group">
      <button type="submit" class="btn" id="touroku">登録</button>
      <button type="reset" class="btn btn-reset">リセット</button>
    </div>
  </form>

  <script>
    // フォームのバリデーション
    window.onload = function () {
      document.getElementById("touroku").addEventListener("click", function (event) {
        const gakuseki = document.getElementById("gakuseki").value;
        const mail = document.getElementById("mail").value;
        const password = document.getElementById("password").value;
        const confirmPassword = document.getElementById("confirmPassword").value;

        let hasError = false;

        // 必須項目のチェック
        if (gakuseki.trim().length === 0) {
          alert('学籍番号を入力してください。');
          hasError = true;
        }

        if (mail.trim().length === 0) {
          alert('メールアドレスを入力してください。');
          hasError = true;
        }

        if (password.trim().length === 0) {
          alert('パスワードを入力してください。');
          hasError = true;
        }

        if (password !== confirmPassword) {
          alert('パスワードが一致していません。');
          hasError = true;
        }

        // 入力形式のチェック
        let formatError = false;

        // 学籍番号の形式チェック
        const gakusekiRegex = /^[A-Z]\d{5}$/;
        if (!gakusekiRegex.test(gakuseki)) {
          document.getElementById('gakuseki_chk').style.display = "block";
          formatError = true;
        } else {
          document.getElementById('gakuseki_chk').style.display = "none";
        }

        // メールアドレスの形式チェック
        const mailRegex = /^e1[a-z]\d{5}@oit\.ac\.jp$/;
        if (!mailRegex.test(mail)) {
          document.getElementById('mail_chk').style.display = "block";
          formatError = true;
        } else {
          document.getElementById('mail_chk').style.display = "none";
        }

        // エラーがある場合はフォーム送信を停止
        if (hasError || formatError) {
          event.preventDefault();
          return false;
        }
      });
    };
  </script>
</body>

</html>
